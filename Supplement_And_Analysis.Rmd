---
title             : "Supplement: Analysis for National Longitudinal Evidence for Growth in Subjective Well-being from Spiritual Beliefs"
author: "contact: joseph.bulbulia@gmail.com on behalf of Highland et al."
date: "27/11/2020"
authornote: |
  <!-- https://tinyurl.com/ybremelq -->
# keywords          : "keywords"
wordcount         : no
bibliography      : ["b-references.bib"]
floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : no
mask              : no
draft             : no
# documentclass     : "apa6"
classoption       : "man"
output            : "html_document" 
editor_options: 
  chunk_output_type: console
---


```{r setup, include = FALSE}
# library("papaja")
#r_refs("r-references.bib")
```

```{r global_options, echo=FALSE, include = FALSE}
knitr::opts_chunk$set(fig.path="figs/", 
                      message=FALSE, 
                      warning=FALSE,
                      collapse =TRUE,
                      echo=TRUE, 
                      #results="hide", 
                      fig.width= 10,
                      fig.height=8,
                      tidy = "styler")
```

This supplement offers a step-by-step analysis for the "Longitudinal Evidence for Growth in Subjective Well-being from Spiritual Beliefs." The functions and other materials for this analysis can be found at the following GitHub link: [https://github.com/jacopastorius/nzavs_spiritbeliefwell-being](https://github.com/jacopastorius/nzavs_spiritbeliefwell-being) 

First, we load our functions. 

```{r load_libraries, echo=TRUE, include=TRUE}
source("libs.R")
source("funs.R")
```

We use functions to automate repetition in coding, to avoid errors from such repetition, and to make the data analysis easier to follow.

This function reads our data into my machine. 
```{r, read_data, cache=TRUE}
# custom function for my machine to read data. you'll need to read data to your machine. tweak function in the `funs.R` script for your machine
d<-data_read_mymachine()

# function to clean data, specify number of waves as 3 
d_3<-data_clean_spirit_wellbeing(d,3) # d = dataframe, 3 = number of waves
# function to count uinque ides
show_unique_id(d_3$Id) 
# function to count waves for participants
count_waves_participants(d_3)
# table of beliefs 
table(d_3$Beliefs)
# years Note that we use a continuous response measure particpants. 
range(d_3$years)
```

## Sample demographic table

```{r, include=FALSE}
# must remove Furniture package before running table 1
demographic_table(d_3)
```

```{r, include=FALSE}
beliefs_table(d_3)
```

<!-- We wrote the publication in $\LaTeX$, which requires converting the tables to .tex files; this conversion used a custom function we wrote in the `funs.R` file.  -->

<!-- ```{r latex_data_table, include=FALSE} -->
<!-- # you might need to install the dev verion.//remotes::install_github("tysonstanley/furniture") -->
<!-- demographic_table_latex() # note the furniture package conflicts with the table1 package. -->
<!-- d_3%>% -->
<!--   group_by(Wave)%>% -->
<!-- furniture::table1( -->
<!--                   Age,  -->
<!--                   NZdep, -->
<!--                   Education, -->
<!--                   Employed, -->
<!--                   Ethnic_Categories, -->
<!--                   Male,Has_Partner,  -->
<!--                   Political_Conservativism, -->
<!--                   Urban,  -->
<!--                   Beliefs,  -->
<!--                   LIFESAT, -->
<!--                   PWI, -->
<!--                   overall=F) -->

<!-- dat3<-d_3%>%dplyr::select( Age, NZdep, -->
<!--                   Education, -->
<!--                   Employed, -->
<!--                   Ethnic_Categories, -->
<!--                   Male,Has_Partner, -->
<!--                   Political_Conservativism, -->
<!--                   Urban, -->
<!--                   Beliefs, -->
<!--                   LIFESAT, -->
<!--                   PWI,Wave) -->
<!-- stargazer::stargazer(dat3) -->
<!-- library(modelsummary) -->
<!--   modelsummary::datasummary_df(ALL(Age) ~ Mean + SD + Histogram, data=dat3) -->
<!-- ``` -->

## How many responses waves to select? 

We selected a minimum of three waves because we want to recover a longitudinal sample in which a slope for the effect of the years $\times$ beliefs effect might be recovered. However, we needed to consider whether our selection of three waves was sensitive to that degree of researcher freedom. So we also prepared 4-8 years of data frames for separate analyses.

```{r, include = TRUE}
# create datasets to test robustness to years
d_4<-data_clean_spirit_wellbeing(d,4) # 4 years
d_5<-data_clean_spirit_wellbeing(d,5) # 5 years
d_6<-data_clean_spirit_wellbeing(d,6) # 6 years
d_7<-data_clean_spirit_wellbeing(d,7) # 7 years
d_8<-data_clean_spirit_wellbeing(d,8) # 7 years

# function to count uinque number of ID's
show_unique_id(d_3$Id) 
show_unique_id(d_4$Id)
show_unique_id(d_5$Id) 
show_unique_id(d_6$Id) 
show_unique_id(d_7$Id) 
show_unique_id(d_8$Id) 

# function to count waves for participants
count_waves_participants(d_3)
count_waves_participants(d_4)
count_waves_participants(d_5)
count_waves_participants(d_6)
count_waves_participants(d_7)
count_waves_participants(d_8)
```

The analyses for these waves is described below. These analyses reveal that the inference of the paper is not sensitive to the threshold number of waves for participant selection. Which is to say, we recover the same inference with an 8-wave selection criterion.

## Covariates

Where $Z$ is a third variable, $X$ is the predictor, and $Y$ is the outcome, there are at least four types of confounding that might arise: 

1. $Z$ causes $X$ and  $Z$ causes $Y$: $Z \leftarrow Z \rightarrow Y$
2. $X$ causes $Z$ and  $Z$ causes $Y$: $X \rightarrow Z \rightarrow Y$
3. $X$ causes $Z$ and $Y$ causes $Z$: $X \rightarrow Z; Y \rightarrow Z$
4. $X$ causes $Z$; $Z$ causes $D$; and we condition on D (the descendent of $Z$: $Y$ causes $Z$: $Z$ \rightarrow D; $X \rightarrow Z; Y \rightarrow Z$ (see: [@mcelreath2020statistical], Chapter 6). 

We do not wish to exclude third variable explanations of the kind that arise from the first type of confounding. The second type of counfounding can mask a relationship. The third and fourth type of confounding illustrate how conditioning on a covariates may confound by *opening* a relationship between the $X$ and $Y$ indicators in a regression analysis. Such confounding is particularly worrying in the case of longitudinal research.  

To address confounding we first obtained the New Zealand Attitudes and Values Study standard demographic indicators recommended to address confounding: [NZAVS modelling standards](https://cdn.auckland.ac.nz/assets/psych/about/our-research/nzavs/NZAVSTechnicalDocuments/NZAVS-Technical-Documents-e11-Default-Statistical-Standards.pdf). Next we modelled potential relationships between the coefficients within the model using the daggity package in R, and plotting results using the daggity and ggdag packages in R.


```{r}
# obtain dag
tidy_ggdag <- dagitty::dagify(
  WB ~ belief + years + partner + nzdep + urban + male + pols + empl,
  WB ~~ partner + years,
  belief ~ years + age + male + ethn,
  partner ~ nzdep + age + belief, 
  nzdep ~ empl,
  pols ~ age  + empl + ethn + years,
  empl ~ nzdep + edu + ethn,
  exposure =  "belief",
  outcome =   "WB")%>%
  tidy_dagitty()

# graph adjustment sets
ggdag::ggdag_adjustment_set(tidy_ggdag, node_size = 14) + 
  theme(legend.position = "bottom") 
```

This method reveals two adjustments sets: \{age, employment, male, political conservativism, and time\}, and \{age, ethnicty, male, and time.\}  We report the second set because employment is likely to contain more measurement error: some are not employed because they cannot find employment, others because they are not seeking employment (e.g. retirement).  However we report both model in our frequentist analysis. Neither model choice effects the results. We also report the simple unadjusted model and the fully saturated model (with potential collider and masking effects). 

A word of caution, the fully-saturated model -- which would be typical in a longitudional regression analysis -- attenuates the growth in personal well-being and in life satisfaction among those who are skeptical in a spirit or Life-fore.  The inference of this study is not sentitive to this difference because the slopes differ for spirit beliefs across all models. However, we do not wish to infer that skepticism about a spirit or life force entirely prevents growth in personal well-being or life-satisfaction. We advise that researchers do not introduce variables into regression mmodels without systematically. evaluating potential confounding. 


## Bayesian data analysis

Bayesian inference require substantial computational resources. The cost of time is repaid with a model that efficiently pools information to produce a more accurate, and transparent, estimate of uncertainty. The posterior distributions of the model describe intuitive conditional probabilities. 

Below we write the model in a notation that explicitly states the the default weakly informative priors that the BRMS package produces. And indicated in the model we include group-level indicator for variation in subject-level intercepts $\alpha_j$, a group-level indicator for subject-level time (or "growth")  slope  $\beta_j$, and we model the co-variance of $\alpha_j$, Below we write the model in a notation that explicitly states the the default weakly informative priors that the BRMS package produces.  And indicated in the model we include group-level indicator for variation in subject-level intercepts $\alpha_j$, a group-level indicator for subject-level time (or "growth")  slope  $\beta_j$, and we model the co-variance of $\alpha_j$ and  $\beta_j$ which for computational reasons is estimate as a correlation matrix of (${\bf S}$} and ${\bf R}$).


### Priors for the Personal Well-Being model

First we report priors for the Personal Well-Being model. Note that we model the correlation of the id-level intercept and id-level year-slope.

\[
\begin{aligned}
\operatorname{Personal Well Being}_{ij} \sim \text{Normal}(\mu_{ij},\sigma^2) \nonumber\\
\mu_{ij}\sim \boldsymbol{\alpha +\beta} \nonumber\\
\boldsymbol{\alpha} \sim \alpha_{0} +\alpha_j \nonumber\\
\alpha_{0} \sim \text{StudentT}(3,7.2,2.5)\nonumber\\
\boldsymbol{\beta}\sim \boldsymbol{b} + \beta_j \nonumber\\
\boldsymbol{b}\sim\text{Normal}(0,2.5) \nonumber\\
\begin{bmatrix}
\alpha_j \\
\beta_j
\end{bmatrix}
\sim 
\text{MVNormal}
\begin{pmatrix}
\begin{bmatrix}
0\\
0
\end{bmatrix}
,\boldsymbol{S} \nonumber
\end{pmatrix}\\
\boldsymbol{S} = 
\begin{pmatrix}
0 & \sigma_{\beta_j} \nonumber
\end{pmatrix} \boldsymbol{R} \begin{pmatrix}
\sigma_{\alpha_j} & 0 \\
0 & \sigma_{\beta_j} \nonumber
\end{pmatrix}\\
\sigma_{\alpha_j} \sim 
\text{HalfCauchy}(0,2.5) \nonumber\\
\sigma_{\beta_j} \sim 
\text{HalfCauchy}(0,2.5) \nonumber\\
\boldsymbol{R}\sim \text{LKJcorr}(1) \nonumber\\
\sigma  \sim  \operatorname{HalfStudent T}^{+}(3, 0, 2.5) 
\end{aligned}
\]


### Priors for the Life Satisfaction model:

Model priors for the  Life Satisfaction model. Here, again, we model the correlation of the id-level intercept and id-level year-slope.

\[
\begin{aligned}
\operatorname{Life Satisfaction}_{ij} \sim \text{Normal}(\mu_{ij},\sigma^2) \nonumber\\
\mu_{ij}\sim \boldsymbol{\alpha +\beta} \nonumber\\
\boldsymbol{\alpha} \sim \alpha_{0} +\alpha_j \nonumber\\
\alpha_{0} \sim \text{StudentT}(3,5.5, 2.5)\nonumber\\
\alpha_j \sim \text{StudentT}+(3,0,2.5)\nonumber\\
\boldsymbol{\beta}\sim \boldsymbol{b} + \beta_j \nonumber\\
\boldsymbol{b}\sim\text{Normal}(0,2.5) \nonumber\\
\begin{bmatrix}
\alpha_j \\
\beta_j
\end{bmatrix}
\sim 
\text{MVNormal}
\begin{pmatrix}
\begin{bmatrix}
0\\
0
\end{bmatrix}
,\boldsymbol{S} \nonumber
\end{pmatrix}\\
\boldsymbol{S} = 
\begin{pmatrix}
\sigma_{\alpha_j} & 0 \\
0 & \sigma_{\beta_j} \nonumber
\end{pmatrix} \boldsymbol{R} \begin{pmatrix}
\sigma_{\alpha_j} & 0 \\
0 & \sigma_{\beta_j} \nonumber
\end{pmatrix}\\
\sigma_{\alpha_j} \sim 
\text{HalfCauchy}(0,1) \nonumber\\
\sigma_{\beta_j} \sim 
\text{HalfCauchy}(0,1) \nonumber\\
\boldsymbol{R}\sim \text{LKJcorr}(1) \nonumber\\
\sigma  \sim  \operatorname{HalfStudent T}^{+}(3, 0, 2.5) 
\end{aligned}
\]

### Theoretical model 

The deterministic part of both the Personal Well-Being and the Life Satisfaction models is as follows. 

\[
\begin{aligned}
& \quad  \boldsymbol{b} = \\
& \quad \beta_{1}(\operatorname{Beliefs}_{\operatorname{SpiritExcludesGod}})\ + \\
&\quad \beta_{2}(\operatorname{Beliefs}_{\operatorname{GodAndSpirit}})\ +  \beta_{3}(\operatorname{Beliefs}_{\operatorname{GodExcludesSpirit}})\ +\\
& \quad \beta_{4}(\operatorname{Years} \times \operatorname{Beliefs}_{\operatorname{SpiritExcludesGod}})\ + \\ 
& \quad \beta_{4}(\operatorname{Years} \times \operatorname{Beliefs}_{\operatorname{GodAndSpirit}})\ + \\
&\quad \beta_{6}(\operatorname{Years} \times \operatorname{Beliefs}_{\operatorname{GodExcludesSpirit}}) \\ 
\end{aligned}
\]





```{r setmodelformula}
forumula_bayesPWI <- bf(PWI ~ yearsC * Beliefs + (1 + yearsC|Id))
forumula_bayesLIFESAT <- bf(LIFESAT ~  yearsC * Beliefs + (1 + yearsC|Id))
```

```{r pwi_bayesmodel}
# PWI
mod.1_b <-brm(forumula_bayesPWI, data= d_3, file ="mod.1_b.rds", cores = 8) # note these are very large files
```

```{r lsbayesmodel}
# LIFE SAT
mod.2_b <-brm (forumula_bayesLIFESAT, data= d_3,cores = 8, file ="mod.2_b.rds")
# note these are very large files
```


```{r simple_table, cache =TRUE}
bayestestR::describe_posterior(mod.1_b, ci = 0.90,  test = c("p_direction"),diagnostic = "ESS")
```

```{r simple_table_ls, cache =TRUE}
bayestestR::describe_posterior(mod.2_b, ci = 0.90, test = c("p_direction"), diagnostic = "ESS")
```




<!-- Tables: -->
<!-- # ```{r pwi_Bayesian_model_table_pwi, cache =TRUE} -->
<!-- # tab_model(mod.1_b) -->
<!-- # ``` -->
<!-- # -->
<!-- # ```{r lifesat_Bayesian_model_table_ls lifesat, cache =TRUE} -->
<!-- # tab_model(mod.2_b) -->
<!-- # ``` -->


<!-- ```{r texreg_bayes_table:pwi,cache=TRUE, include=FALSE} -->
<!-- #Results for publication. -->
<!-- table_model_latex_pwi(mod.1_b) -->
<!-- ``` -->

<!-- ```{r texreg_bayes_table:ls, cache=TRUE, include=FALSE} -->
<!-- table_model_latex_ls(mod.2_b) -->
<!-- ``` -->

<!-- Coefficient plots used in manuscript-->
<!-- ```{r coefficientplotsbayes, cache=TRUE} -->
<!-- plot_coefs(mod.1_b,mod.2_b) -->
<!-- ``` -->

```{r stancode for models, include=FALSE}
#model equation
#Here we extract our priors for reporting

stancode(mod.1_b)
stancode(mod.2_b)
```

```{r prior summaries, include =FALSE}
#this does the same as the stancode
brms::prior_summary(mod.1_b)
brms::prior_summary(mod.2_b)
```

```{r Bayesian_model_table, cache=TRUE}
#tab_model(mod.1_b, show.ci= .89) # we really should use something other than 95 but the team consensus is to use 95
tab_model(mod.1_b, mod.2_b, show.ci= .95) # no difference to inference
```

We inspected the posterior distributions, which look good.

```{r mixing_pwi, cache=TRUE}
plot(mod.1_b, pars ="b_") 
```

```{r mixing_ls, cache=TRUE}
plot(mod.2_b, pars ="b_") 
```

As do the random components

```{r mixing_sd_pwi, cache=TRUE}
plot(mod.1_b, pars ="sd_") #
```

```{r mixing_ls_pwi, cache=TRUE}
plot(mod.2_b, pars ="sd_") # 
```


The posterior prediction plots look reasonable.  

```{r posteriorpredictivechecks:pwi, cache=TRUE}
# cannot run on my laptop
pp_1<-rstanarm::pp_check(mod.1_b) + ylab("Personal well-being")
pp_2<-rstanarm::pp_check(mod.2_b) + ylab("Life Satisfaction") ## life sat suggests an ordinal model
pp_1 + pp_2
```

### Predictions graphs

Personal Well being predictions.

```{r}
preds_1b<-get_predictions(mod.1_b)
preds_1b
```

Life Satisfaction predictions.

```{r}
preds_2b<-get_predictions(mod.2_b)
preds_2b
```

Next we graph the expected effects. 

```{r Bayesian_pwi_predicted, cache=TRUE, dependson= mod.1_b}
graph_predictions(mod.1_b, "Predicted Values of Personal Well-Being")
```

```{r Bayesian_lifesat_predicted, cache=TRUE, dependson= mod.2_b}
graph_predictions(mod.2_b, "Predicted Values of Life Satisfaction")
```

To close the "back door" on potential confounds we create a regression model
```{r dag}
library("dagitty")
library("ggdag")

# theoretically plausible relationships
tidy_ggdag <- dagify(
  WB ~ belief + time + age + partner + nzdep + urban + male + pols + empl, # what might affect wellbeing?
  WB ~~ partner, # bi-causal path
  belief ~ time + age + male + ethn, # predictors of beliefs
  partner ~ nzdep + age + belief,  # predictors of having a partner
  nzdep ~ empl,  # predictor of deprivation
  pols ~ age  + empl + ethn, # predictor of political orientation
  empl ~ nzdep + edu + ethn, # predictor of employment
  exposure =  "belief",
  outcome =   "WB")%>%
  tidy_dagitty()

#graph
ggdag_adjustment_set(tidy_ggdag, node_size = 14) + 
  theme(legend.position = "bottom") 
```


# Bayesian counfounder model


```{r setmodelformulaSAT}
forumula_bayesPWI_DAG <- bf(PWI ~  yearsC * Beliefs +  Age_in_Decades_C + Ethnic_Categories + Male + (1+ yearsC|Id))
forumula_bayesLIFESAT_DAG <- bf(LIFESAT ~   yearsC * Beliefs +  Age_in_Decades_C + Ethnic_Categories + Male + (1+ yearsC|Id))
```

```{r pwi_bayesmodelPWI_DAG}
# PWI
mod.1_bDAG <-brm(forumula_bayesPWI_DAG, data= d_3, file ="mod.1_bDAG.rds", cores = 8) # note these are very large files
summary(mod.1_bDAG)
```


```{r lsbayesmodelLS_DAG}
# LIFE SAT
mod.2_bDAG <-brm (forumula_bayesLIFESAT_DAG, data= d_3,cores = 8, file ="mod.2_bDAG.rds")
###
tab_model(mod.1_bDAG,mod.2_bDAG)
# note these are very large files
```

The posterior prediction plots look reasonable.  

```{r posteriorpredictivechecks:pwi_BAYES_CONFOUNDER, cache=TRUE}
# cannot run on my laptop
pp_1<-rstanarm::pp_check(mod.1_bDAG) + ylab("Personal well-being")
pp_2<-rstanarm::pp_check(mod.2_bDAG) + ylab("Life Satisfaction") ## life sat suggests an ordinal model
pp_1 
```

```{r posteriorpredictivechecks:ls_BAYES_CONFOUNDER}
pp_2
```


```{r Bayesian_model_table, cache=TRUE, include =FALSE}
table_model_latex_dual(mod.1_bDAG,mod.2_bDAG)
```


```{r cache =TRUE}
g1dag1<-plot(parameters::model_parameters(mod.1_bDAG))+ ggtitle("Personal Well-Being Coefficients")
g2dag1<-plot(parameters::model_parameters(mod.2_bDAG))+ ggtitle("Life Satisfaction Coefficients")
```

And here's the graph.

```{r plot_coefficientplots_BayesDAG1, cache = TRUE}
g1dag1/g2dag1
```
we used `r cite_r("b-references.bib")`





```{r cache =TRUE}
g1dag1<-plot(parameters::model_parameters(mod.1dag))+ ggtitle("Personal well-being Coefficients")
g2dag1<-plot(parameters::model_parameters(mod.2dag))+ ggtitle("Life Satisfaction Coefficients")
```

And here's the graph.

```{r plot_coefficientplots_LMER_FULL, cache = TRUE}
g1dag1/g2dag1
```

Get the predictions

```{r Bayesian_pwi_predictedSAT, cache=TRUE, dependson= mod.1_b}
get_predictions(mod.1_bDAG)
```

```{r Bayesian_lifesat_predictedSAT, cache=TRUE, dependson= mod.2_b}
get_predictions(mod.2_bDAG)
```


```{r Bayesian_pwi_predictedSAT, cache=TRUE, dependson= mod.1_b}
graph_predictions(mod.1_bDAG, "Predicted Values of Personal Well-Being: Bayesian Model (Confounder Adjusted)")
```

```{r Bayesian_lifesat_predictedSAT, cache=TRUE, dependson= mod.2_b}
graph_predictions(mod.2_bDAG, "Predicted Values of Life Satisfaction: Bayesian Model (Confounder Adjusted)")
```



# describe the posteriors 
```{r simple_table, cache =TRUE}
bayestestR::describe_posterior(mod.1_bDAG, test = c("p_direction"),diagnostic = "ESS")
```

```{r simple_table_ls, cache =TRUE}
bayestestR::describe_posterior(mod.2_bDAG, test = c("p_direction"), diagnostic = "ESS")
```



## Test of the Bayesian saturacted model  for the record


```{r setmodelformulaSAT}
# note that BRMS automatically centers so we do not need to center years
forumula_bayesPWI_SATUR <- bf(PWI ~  years * Beliefs +  Age_in_Decades_C + Deprivation_S + Education_S  + Employed + Ethnic_Categories + Male  + Has_Partner  + Political_Conservativism_S + Urban + (1+ years|Id))

forumula_bayesLIFESAT_SATUR <- bf(LIFESAT ~  yearsC * Beliefs +  Age_in_Decades_C + Deprivation_S + Education_S  + Employed + Ethnic_Categories + Male  + Has_Partner  + Political_Conservativism_S + Urban + (1+ years|Id))
```


```{r pwi_bayesmodelSAT}
# PWI
mod.1_bSAT <-brm(forumula_bayesPWI_SATUR, data= d_3, file ="mod.1_bS.rds", cores = 8) # note these are very large files
summary(mod.1_bSAT)
```

```{r Bayesian_pwi_predictedSAT, cache=TRUE, dependson= mod.1_b}
graph_predictions(mod.1_bSAT, "Predicted Values of Personal Well-Being")
```


```{r Bayesian_lifesat_predictedSAT, cache=TRUE, dependson= mod.2_b}
graph_predictions(mod.2_b, "Predicted Values of Life Satisfaction")
```



```{r lsbayesmodelSAT}
# LIFE SAT
mod.2_bSAT <-brm (forumula_bayesLIFESAT_SATUR, data= d_3,cores = 8, file ="mod.2_bS.rds")
summary(mod.2_bSAT)
###
tab_model(mod.1_bSAT,mod.2_bSAT)
# note these are very large files
```




## REML estimation

Many researchers have yet to familiarise themselves with Bayesian estimation. We therefore report results from models using a Maximum Likelihood estimator. We do so to avoid the perception of chicanery, as our experience is that such a choice does not affect inference for a dataset such as ours.  ML estimatation is also faster than our preferred Bayesian estimator. 

Results are virtually identical to the Bayesian model.

```{r robust to years and beliefs only, cache = TRUE, dependson=d_3,cache =TRUE}
library(lme4)
pwi_formula_simple <- 'PWI ~  yearsC * Beliefs + (1+ yearsC|Id)'
ls_formula_simple <- 'LIFESAT ~  yearsC * Beliefs + (1+ yearsC|Id)'
mod.1aa <-lmer(pwi_formula_simple, data= d_3)
mod.2aa <-lmer(ls_formula_simple, data= d_3)

# table
sjPlot::tab_model(mod.1aa,mod.2aa)
```

Here is a predictive graph for years $\times$ beliefs interaction on PWI. Rhe function for producing this graph is in the `funs.R` file. 

```{r Bayesian_pwi_predict, cache =TRUE}
graph_predictions(mod.1aa, "Predicted Values of Personal well-being")
```

Here is a predictive graph for the years $\times$ beliefs interaction on life satisfaction. 

```{r Bayesian_lifesat_predict, cache =TRUE}
graph_predictions(mod.2aa, "Predicted Values of Life Satisfaction")
```

## Adjusting for Demographics. 

Next we attempted a model with that is adjusted by "usual suspect" demographic indicator. The inference remains unchanged. 

```{r lmer_model_with_full_covariates, cache =TRUE}
library(lme4)
pwi_formula <- 'PWI ~  yearsC * Beliefs +  Age_in_Decades_C + Deprivation_S + Education_S  + Employed + Ethnic_Categories + Male  + Has_Partner  + Political_Conservativism_S + Urban + (1 + yearsC|Id)'
ls_formula <- 'LIFESAT ~  yearsC * Beliefs +  Age_in_Decades_C + Deprivation_S + Education_S  + Employed + Ethnic_Categories + Male  + Has_Partner  + Political_Conservativism_S + Urban + (1 + yearsC|Id)'

mod.1 <-lmer (pwi_formula, data= d_3)
mod.2 <-lmer (ls_formula, data= d_3)
```

Here is the table.
```{r saturated model, cache = TRUE, dependson=d_3}
sjPlot::tab_model(mod.1,mod.2)
```

We compared complex with simple models, and we found the inference does not change. 
```{r}
# identical result
sjPlot::tab_model(mod.1,mod.1aa)
sjPlot::tab_model(mod.2,mod.2aa)
```

Next we checked for multi-collinearity. Multi-collinearity is low. (Note that we centre the "years" variable, had we not done this, mult-collinearity would have been high).  

```{r check collinearity, cache =TRUE}
# Low VIFS from 
performance::check_collinearity(mod.1)
performance::check_collinearity(mod.2)
```


## Adjustment using DAG 

### First confounder model 

```{r lmer_model_with_full_covariatesDAG1, cache =TRUE}
library(lme4)
pwi_formulaDag1 <- 'PWI ~  yearsC * Beliefs +  Age_in_Decades_C  + Ethnic_Categories + Male + (1 + yearsC|Id)'
ls_formulaDag1 <- 'LIFESAT ~ yearsC * Beliefs +  Age_in_Decades_C  + Ethnic_Categories + Male  + (1 + yearsC|Id)'

mod.1dag1 <-lmer (pwi_formulaDag1, data= d_3)
mod.2dag1 <-lmer (ls_formulaDag1, data= d_3)
```

Here is the table.
```{r tab_dag1, cache = TRUE, dependson=d_3}
sjPlot::tab_model(mod.1dag1,mod.2dag1)
```

We compared complex with simple models, and we found the inference does not change. 
```{r}
# identical result
sjPlot::tab_model(mod.1dag1,mod.2dag1)
```




```{r Bayesian_lifesat_predict, cache =TRUE}
graph_predictions(mod.1dag1, "Predicted Values of Life Satisfaction: Dag 1")
```
```{r Bayesian_lifesat_predict, cache =TRUE}
graph_predictions(mod.2dag1, "Predicted Values of Life Satisfaction: Dag 1")
```


## Second confounder model 

```{r lmer_model_with_full_covariates, cache =TRUE}
library(lme4)
pwi_formulaDag2 <- 'PWI ~  yearsC * Beliefs +  Age_in_Decades_C  + Employed + Male + Deprivation_S + Political_Conservativism_S + (1 + yearsC|Id)'
ls_formulaDag2 <- 'LIFESAT ~ yearsC * Beliefs + Employed +  Age_in_Decades_C  + Employed + Male + Deprivation_S + Political_Conservativism_S + (1 + yearsC|Id)'

mod.1dag2 <-lmer (pwi_formulaDag2, data= d_3)
mod.2dag2 <-lmer (ls_formulaDag2, data= d_3)
```

Here is the table

```{r tab_dag2, cache = TRUE, dependson=d_3}
sjPlot::tab_model(mod.1dag2,mod.1dag2)
```


```{r dag2_plotcreate cache =TRUE}
g1dag2<-plot(parameters::model_parameters(mod.1dag2))+ ggtitle("Personal well-being Coefficients")
g2dag2<-plot(parameters::model_parameters(mod.2dag2))+ ggtitle("Life Satisfaction Coefficients")
```

And here's the graph.

```{r plot_coefficientplots_LMER_FULL_DAG2, cache = TRUE}
g1dag2/g2dag2 
```


```{r Bayesian_lifesat_predict, cache =TRUE}
graph_predictions(mod.1dag2, "Predicted Values of Life Satisfaction: Dag 2")
```

```{r Bayesian_lifesat_predict, cache =TRUE}
graph_predictions(mod.2dag2, "Predicted Values of Life Satisfaction: Dag 2")
```


Note we would prefer the the first counfounder model because there is less measurement error (not employed could mean mean not retired). 

Additionally the first counfounder model has fewer terms to estimate. 




### ELSE
For the record, we report the fully saturated "everything but the kitchen sink" model.  We show that throwing all regression coefficients produces a stronger effect for beliefs. 

```{r lmer model centering years}
library(lme4)
pwi_formulaC <- 'PWI ~  yearsC * Beliefs +  Age_in_Decades_C + Deprivation_S + Education_S  + Employed + Ethnic_Categories + Male  + Has_Partner  + Political_Conservativism_S + Urban + (1+ yearsC|Id)'

ls_formulaC <- 'LIFESAT ~  yearsC * Beliefs +  Age_in_Decades_C + Deprivation_S + Education_S  + Employed + Ethnic_Categories + Male  + Has_Partner  + Political_Conservativism_S + Urban + (1+ yearsC|Id)'
summary(mod.1a)
mod.1a <-lmer (pwi_formulaC, data= d_3)
mod.2a <-lmer (ls_formulaC, data= d_3)


# identical result
performance::check_collinearity(mod.1a)
performance::check_collinearity(mod.2a)
```

Here's the table, again, we find inference is robust. 


```{r table of saturated models, cached = TRUE}
sjPlot::tab_model(mod.1a,mod.2a)
```


<!-- Her are the coefficient plots for the full models -->
<!-- ```{r coefficientplots_LMER_FULL, cache=TRUE} -->
<!-- plot_models(mod.2, mod.1) + ylim(-.4, .75) + theme_plain()  # Plots -->
<!-- ``` -->

Here is the code for the coefficient plots of our preferred simple model.

```{r cache =TRUE}
g1<-plot(parameters::model_parameters(mod.1aa))+ ggtitle("Personal well-being Coefficients")
g2<-plot(parameters::model_parameters(mod.2aa))+ ggtitle("Life Satisfaction Coefficients")
```

And here's the graph.

```{r plot_coefficientplots_LMER_FULL, cache = TRUE}
g1/g2
```

Next, recall we want to check whether inference is robustness to the researcher degree of freedom in selecting how many number of waves a participant must have responded to for inclusion.

```{r run all the models with different ns, cache = TRUE}
mod.1_3 <-lmer (pwi_formula_simple, data= d_4)
mod.2_3 <-lmer (ls_formula_simple, data= d_4)

mod.1_4 <-lmer (pwi_formula_simple, data= d_4)
mod.2_4 <-lmer (ls_formula_simple, data= d_4)

mod.1_5 <-lmer (pwi_formula_simple, data= d_5)
mod.2_5 <-lmer (ls_formula_simple, data= d_5)

mod.1_6 <-lmer (pwi_formula_simple, data= d_6)
mod.2_6 <-lmer (ls_formula_simple, data= d_6)

mod.1_7 <-lmer (pwi_formula_simple, data= d_7)
mod.2_7 <-lmer (ls_formula_simple, data= d_7)

mod.1_8 <-lmer (pwi_formula_simple, data= d_8)
mod.2_8 <-lmer (ls_formula_simple, data= d_8)
```

Let's plot all the models. We find that uncertainty increases, but that, again, the inference remains robust. 

```{r extremes_of_researcher_degree_of_freedom_test, cache =TRUE}
library(parameters)
g1a_3<-plot(parameters::model_parameters(mod.1_3))+ ggtitle("Personal well-being Coefficients: 8 Waves")
g2a_3<-plot(parameters::model_parameters(mod.2_3))+ ggtitle("Life Satisfaction Coefficients: 8 Waves")

g1a_8<-plot(parameters::model_parameters(mod.1_8))+ ggtitle("Personal well-being Coefficients: 8 Waves")
g2a_8<-plot(parameters::model_parameters(mod.2_8))+ ggtitle("Life Satisfaction Coefficients: 8 Waves")
```

```{r USE_2_coefficientplots_LMER_FULL_pwi,cache =TRUE}
library(patchwork)
g1a_3/g1a_8 +   plot_annotation(title = "Compare 3 X response model (top) with 8 X response model (bottom): Personal Well-Being")
```

```{r USE_2_coefficientplots_LMER_FULL_ls,cache =TRUE}
library(patchwork)
g2a_3/g2a_8 +   plot_annotation(title = "Compare 3 X response model (top) with 8 X response model (bottom) : Life Satisfaction")
```

Next, we modelled the relationship between having a partner and deprivation. We did so to address a reviewer's worry that we might have introduced correlation of between deprivation and having a partner that could spoil inference. We indeed found such a relationship. This is an important potential confound, and another reason to favour the simple longitudinal model that we used.  

```{r checkforref model,cache =TRUE}
m<-lmer (NZdep ~ Partner + (1|Id), data= d_3, na.action = na.omit)
tab_model(m)
model_parameters(m)
```


# Missing Data Analysis

Finally, we ran our analyses on 10 multiply imputed datasets. Missing responses can be an important source of bias in a longitudinal study. Again we wrote some functions to deal with all the work, you can find these in `funs.R` file.

```{r echo = TRUE,  cache = TRUE}
# Imputed data
imputed3<-amelia_imputation_clean(d_3)
# saveRDS(imputed3,"imputed3")
# imputed3<-readRDS(imputed3)
```

We reran the imputed data analysis.

```{r cache = TRUE, imputedsimplePWI, cache=TRUE}
# run models iterating over imputed data
mod_imputed_pwi<-loop_lmer_model(pwi_formula_simple, imputed3)
```

```{r imputed pwi table, cache=TRUE}
tab_mods_pwi<-loop_lmer_model_tab(mod_imputed_pwi)
#create_hux_table(tab_mods_pwi)
```

Next a graph of the coefficients.

```{r coef_PWI_imputed_coefplot, cache =TRUE}
# coeff plot
imp_pwi <- plot(tab_mods_pwi) + ggtitle("Personal well-being Coefficients (Imputed)") # pick your  own title
```

The inference is robust in the imputation model.

The following code returns the analysis for the life satisfaction model (again the functions are in the `funs.R` file).

```{r cache = TRUE}
# run models iterating over imputed data
mod_imputed_ls<-loop_lmer_model(ls_formula_simple,imputed3)

```{r table_ls_imputed,cache=TRUE}
# table
tab_mods_ls<-loop_lmer_model_tab(mod_imputed_ls)
#create_hux_table(tab_mods_ls)
```

Here's the graph:

```{r coef_imputed_ls, cache = TRUE}
# coeff plot
imp_ls<-plot(tab_mods_ls) + ggtitle("Life Satisfaction Coefficients (Imputed)") 
```
We found that the model is robust to multiple imputations over the missing data, though with greater uncertainty for the Personal Well-being effect. 

```{r coefficient_plot_both_imputed,  cache = TRUE}
 imp_pwi/imp_ls +  plot_annotation(tag_levels = 'i')
```

Here are the prediction graphs.

```{r  coef_PWI_imputed coefplot, cache=TRUE}
# function for prediction
graph_predictions_imputed(mod_imputed_pwi,"Predicted Values of Personal well-being (imputed)")
```

```{r pred_LS_imputed,  cache = TRUE}
# function for prediction
graph_predictions_imputed(mod_imputed_ls,"Predicted Values of Life Satisfaction (imputed)")
```

<!-- ## Bayesian Multiple imputation models -->
<!-- We wanted to run a Bayesian MI model. However, we did this, we blew up the RAM in JB's machine. So we must satisfy ourselves with ML MI models.  -->
<!-- ```{r} won't work for missing categorical predictors--> 
<!-- form_pwi <- bf(PWI | mi() ~ years * mi(Beliefs)) + -->
<!--   bf(Beliefs | mi() ~ years) + set_rescor(FALSE) -->
<!-- imp_bayes_pwi <- brm(form_pwi, data = d_3) -->
<!-- ``` -->
<!-- ```{r create data frame of lists for BRMS imputation} -->
<!-- # brms requires a list of the imputations -->
<!-- brmdat <-list(imputed3$imputations$imp1, -->
<!--               imputed3$imputations$imp2, -->
<!--               imputed3$imputations$imp3, -->
<!--               imputed3$imputations$imp4, -->
<!--               imputed3$imputations$imp5, -->
<!--               imputed3$imputations$imp6,   -->
<!--               imputed3$imputations$imp7, -->
<!--               imputed3$imputations$imp8, -->
<!--               imputed3$imputations$imp9, -->
<!--               imputed3$imputations$imp10) -->
<!-- ``` -->
<!-- ```{r Bayesian imputed model_pwi} -->
<!-- # not run -->
<!-- #fit_imp1 <- brm_multiple(PWI ~ years * Beliefs + (1 + years|Id), data = brmdat) -->
<!-- #summary(fit_imp1) -->
<!-- #save(fit_imp1) -->
<!-- ``` -->
<!-- ```{r Bayesian imputation model_ls} -->
<!-- # not run -->
<!-- #fit_imp2 <- brm_multiple(LIFESAT ~ years * Beliefs + (1+years|Id), data = brmdat, file = "fit_imp2") -->
<!-- ``` -->

There are further analyses that we ran (e.g. within/between subject effects). These can be found in the GitHub link, posted above. The inferences remain the same.

```{r}
print(citation("brms"), bibtex=TRUE)
```

## Data

The NZAVS is an ongoing longitudinal study. Our ethics requires us to protect the privacy of our participants. For this reason, we cannot post the raw data, even anonymous data. However, we provide data by request to qualified researchers for the purposes of replication. We areare interested in collaboration with qualified researchers: please contact Chris G. Sibley [c.sibley@auckland.ac.nz](c.sibley@auckland.ac.nz).


# References

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id="refs" custom-style="Bibliography"></div>
\endgroup
<!-- ## model equations -->
<!-- ```{r} -->
<!-- stancode(mod.1_b) -->
<!-- ``` -->
<!-- <!-- Frequentist model: -->
<!-- ```{r eq1} -->
<!-- library(equatiomatic) -->
<!-- summary(mod.1aa) -->
<!-- print(extract_eq(mod.1aa, wrap = TRUE)) -->
<!-- ``` -->
<!-- ```{r eq2} -->
<!-- library(equatiomatic) -->
<!-- print(extract_eq(mod.1aa, wrap = TRUE, use_coefs=TRUE,terms_per_line = 3)) -->
<!-- ``` -->
<!-- We might want to look at within/between indivual change (i.e. do people who change in degree of spirit beliefs manifest different well-being.  I ran this as below, however, what we really want is a markov model, where we compare state changes between the different types of belief. So this model is not useful. For more on demeaning see:  -->
<!-- https://easystats.github.io/parameters/articles/demean.html -->
<!-- ```{r} -->
<!-- dfben <- cbind( -->
<!--   dfben, -->
<!--   parameters::demean(dfben, select = c("Beliefs"), group = "Id") -->
<!-- ) -->
<!-- ``` -->
<!-- ```{r models, cache = TRUE, dependson = "dfben"} -->
<!-- ### Spirit Belief Models ###  -->
<!-- mod01<-lmer (PWI ~ Years + -->
<!--                 Beliefs__Skeptic__between  +   -->
<!--                 Beliefs__SpiritExcludesGod__between +  -->
<!--                 Beliefs_GodAndSpirit_between  +  -->
<!--                 Beliefs_GodExcludesSpirit_between + -->
<!--                 Beliefs__Skeptic__within  +   -->
<!--                 Beliefs__SpiritExcludesGod__within +  -->
<!--                 Beliefs_GodAndSpirit_within  +  -->
<!--                 Beliefs_GodExcludesSpirit_within + -->
<!--                 (1|Id), data= dfben, na.action = na.omit) -->
<!-- parameters::check_heterogeneity(mod01, group = "ID") -->
<!-- parameters::check_heterogeneity(mod01, group = "ID") -->
<!-- mod02<-lmer (LIFESAT ~ Years + -->
<!--                 Beliefs__Skeptic__between  +   -->
<!--                 Beliefs__SpiritExcludesGod__between +  -->
<!--                 Beliefs_GodAndSpirit_between  +  -->
<!--                 Beliefs_GodExcludesSpirit_between + -->
<!--                 Beliefs__Skeptic__within  +   -->
<!--                 Beliefs__SpiritExcludesGod__within +  -->
<!--                 Beliefs_GodAndSpirit_within  +  -->
<!--                 Beliefs_GodExcludesSpirit_within + -->
<!--                 (1|Id), data= dfben, na.action = na.omit) -->
<!-- parameters::check_heterogeneity(mod02, group = "ID") -->
<!-- # inference holds, but can we use this method with factors? What do the contrasts mean?  -->
<!-- tab_model(mod01) -->
<!-- tab_model(mod02) -->
<!-- plot_models(mod01,mod02) -->
<!-- ``` -->
<!-- ```{r eq1} -->
<!-- #for model equation -->
<!-- library(equatiomatic) -->
<!-- print(extract_eq(mod.1, wrap = TRUE,terms_per_line =3)) -->
<!-- ``` -->
<!-- PWI Model 2 equation -->
<!-- ```{r eq2} -->
<!-- library(equatiomatic) -->
<!-- print(extract_eq(mod.2, wrap = TRUE, use_coefs=TRUE,terms_per_line = 3)) -->
<!-- ``` -->
<!-- ## report -->
<!-- ### Model 1 -->
<!-- model 1 report: for publication change all "significants" to "reliable" -->
<!-- short report: -->
<!-- ```{r, report1, cache =TRUE, dependson=mod.1,include=FALSE} -->
<!-- easystats::model_text(mod.1) -->
<!-- ``` -->
<!-- short report -->
<!-- ```{r, cache=TRUE, include=FALSE } -->
<!-- library(report) -->
<!-- r1<- easystats::report(mod.1) -->
<!-- easystats::table_short(r1) -->
<!-- easystats::text_short(r1) -->
<!-- ``` -->
<!-- ```{r, cache =TRUE, dependson=mod.1, include=FALSE} -->
<!-- r1<- easystats::report(mod.1) -->
<!-- easystats::text_long(r1) -->
<!-- ``` -->
<!-- short report -->
<!-- ```{r, cache =TRUE, dependson=mod.2,include=FALSE} -->
<!-- # Model 2 -->
<!-- # For publication change all "significants" to "reliable" -->
<!-- easystats::model_text(mod.2) -->
<!-- ``` -->
<!-- short report -->
<!-- ```{r,include=FALSE} -->
<!-- r2 <- easystats::report(mod.2) -->
<!-- easystats::text_short(r2) -->
<!-- easystats::table_short(r2) -->
<!-- ``` -->
<!-- long report -->
<!-- ```{r,include=FALSE} -->
<!-- r2<- easystats::report(mod.2) -->
<!-- easystats::text_long(r2) -->
<!-- ``` -->
<!-- ## Equation 1: Personal Well-being  -->
<!-- model equations for models without random intercept slope correlations; not correct, or reported\[ -->
<!-- \begin{aligned} -->
<!-- \operatorname{{\small PWI}}  &\sim N \left(\mu,\sigma^2 \right) \\  -->
<!-- \mu & =  \boldsymbol{a} +  \boldsymbol{b} \\ -->
<!-- & \quad \boldsymbol{a} =  \alpha_{0} + \alpha_{j[i]} \\ -->
<!-- & \quad \alpha_{0} \sim \operatorname{Student T}^{+}(3,7.2,2.5) \\ -->
<!-- & \quad  \alpha_{j[i]}  \sim \operatorname{Normal}(0, \sigma_j) \\  -->
<!-- & \quad \sigma_j \sim \operatorname{HalfStudent T}^{+}(3, 0, 2.5) \\ -->
<!-- & \quad   \boldsymbol{b}   \sim \operatorname{Student T}^{+}(0, 2.5) \\  -->
<!-- & \quad \sigma  \sim  \operatorname{HalfStudent T}^{+}(3, 0, 2.5) \\ -->
<!-- & \quad  \boldsymbol{b} = \\ -->
<!-- & \quad \beta_{2}(\operatorname{Beliefs}_{\operatorname{SpiritExcludesGod}})\ + \\ -->
<!-- &\quad \beta_{3}(\operatorname{Beliefs}_{\operatorname{GodAndSpirit}})\ +  \beta_{4}(\operatorname{Beliefs}_{\operatorname{GodExcludesSpirit}})\ +\\ -->
<!-- & \quad \beta_{5}(\operatorname{Years} \times \operatorname{Beliefs}_{\operatorname{SpiritExcludesGod}})\ + \\  -->
<!-- & \quad \beta_{17}(\operatorname{Years} \times \operatorname{Beliefs}_{\operatorname{GodAndSpirit}})\ + \\ -->
<!-- &\quad \beta_{18}(\operatorname{Years} \times \operatorname{Beliefs}_{\operatorname{GodExcludesSpirit}}) \\  -->
<!-- \end{aligned} -->
<!-- \] -->
<!-- ## Equation 2: Life Satisfaction. -->
<!-- \[ -->
<!-- \begin{aligned} -->
<!-- \operatorname{{\small LifeSatisfaction}}  &\sim N \left(\mu,\sigma^2 \right) \\  -->
<!-- \mu & =  \boldsymbol{a} +  \boldsymbol{b} \\ -->
<!-- & \quad \boldsymbol{a} =  \alpha_{0} + \alpha_{j[i]} \\ -->
<!-- & \quad \alpha_{0} \sim \operatorname{Student T}^{+}(3,5.5, 2.5) \\ -->
<!-- & \quad  \alpha_{j[i]}  \sim \operatorname{Normal}(0, \sigma_j) \\  -->
<!-- & \quad \sigma_j \sim \operatorname{HalfStudent T}^{+}(3, 0, 2.5) \\ -->
<!-- & \quad   \boldsymbol{b}   \sim \operatorname{Student T}^{+}(0, 2.5) \\  -->
<!-- & \quad \sigma  \sim  \operatorname{HalfStudent T}^{+}(3, 0, 2.5) \\ -->
<!-- & \quad  \boldsymbol{b} = \\ -->
<!-- & \quad \beta_{2}(\operatorname{Beliefs}_{\operatorname{SpiritExcludesGod}})\ + \\ -->
<!-- &\quad \beta_{3}(\operatorname{Beliefs}_{\operatorname{GodAndSpirit}})\ +  \beta_{4}(\operatorname{Beliefs}_{\operatorname{GodExcludesSpirit}})\ +\\ -->
<!-- & \quad \beta_{5}(\operatorname{Years} \times \operatorname{Beliefs}_{\operatorname{SpiritExcludesGod}})\ + \\  -->
<!-- & \quad \beta_{17}(\operatorname{Years} \times \operatorname{Beliefs}_{\operatorname{GodAndSpirit}})\ + \\ -->
<!-- &\quad \beta_{18}(\operatorname{Years} \times \operatorname{Beliefs}_{\operatorname{GodExcludesSpirit}}) \\  -->
<!-- \end{aligned} -->
<!-- \] -->
<!-- ## Equation 2 -->
<!-- \[ -->
<!-- \begin{aligned} -->
<!-- \operatorname{{\small LIFESAT/PWI}}  &\sim N \left(\mu,\sigma^2 \right) \\ \mu &=\alpha_{j[i]} + \beta_{1}(\operatorname{Years}) + \beta_{2}(\operatorname{Beliefs}_{\operatorname{SpiritExcludesGod}})\ + \\ -->
<!-- &\quad \beta_{3}(\operatorname{Beliefs}_{\operatorname{GodAndSpirit}}) + \beta_{4}(\operatorname{Beliefs}_{\operatorname{GodExcludesSpirit}}) + \beta_{5}(\operatorname{Age.10yrs.C})\ + \\ -->
<!-- &\quad \beta_{6}(\operatorname{Deprivation.S}) + \beta_{7}(\operatorname{Edu.S}) + \beta_{8}(\operatorname{Employed})\ + \\ -->
<!-- &\quad \beta_{9}(\operatorname{EthnicCats}_{\operatorname{Maori}}) + \beta_{10}(\operatorname{EthnicCats}_{\operatorname{Pacific}}) + \beta_{11}(\operatorname{EthnicCats}_{\operatorname{Asian}})\ + \\ -->
<!-- &\quad \beta_{12}(\operatorname{Male}_{\operatorname{1}}) + \beta_{13}(\operatorname{Partner}_{\operatorname{Has\ }}) + \beta_{14}(\operatorname{Pol.Orient.S})\ + \\ -->
<!-- &\quad \beta_{15}(\operatorname{Urban}) + \beta_{16}(\operatorname{Years} \times \operatorname{Beliefs}_{\operatorname{SpiritExcludesGod}}) + \beta_{17}(\operatorname{Years} \times \operatorname{Beliefs}_{\operatorname{GodAndSpirit}})\ + \\ -->
<!-- &\quad \beta_{18}(\operatorname{Years} \times \operatorname{Beliefs}_{\operatorname{GodExcludesSpirit}}) \\ \alpha_{j} &\sim N \left(\mu_{\alpha_{j}},\sigma^2_{\alpha_{j}} \right) , \operatorname{ for  Id }~j~= 1, \dots~J = 20,979~\operatorname{Individuals} -->
<!-- \end{aligned} -->
<!-- \] -->
<!-- \[ -->
<!-- \begin{table}[ ht ]  -->
<!-- \centering  -->
<!-- \caption{}\label{} -->
<!-- \scalebox{.6}{ -->
<!-- \begin{tabular}{ l c c c c c c c c c } -->
<!-- \toprule -->
<!--  &   \multicolumn{ 9 }{c}{ Wave }\\  -->
<!--   & 2010 & 2011 & 2012 & 2013 & 2014 & 2015 & 2016 & 2017 & 2018 \\  -->
<!--  & n = \emph{missing} & n = \emph{missing} & n = 8547 & n = 13472 & n = \emph{missing} & n = 11687 & n = 16048 & n = 14174 & n = 14883 \\  -->
<!--  \midrule -->
<!-- Age &   &   &   &   &   &   &   &   &  \\  -->
<!-- NZdep &   &   &   &   &   &   &   &   &  \\  -->
<!-- Education &   &   &   &   &   &   &   &   &  \\  -->
<!-- Employed &   &   &   &   &   &   &   &   &  \\  -->
<!-- \hspace{6pt}    0 &  (\%) &  (\%) & 2094 (24.5\%) & 2955 (21.9\%) &  (\%) & 2525 (21.6\%) & 3486 (21.7\%) & 3223 (22.7\%) & 3404 (22.9\%)\\  -->
<!-- \hspace{6pt}    1 &  (\%) &  (\%) & 6453 (75.5\%) & 10517 (78.1\%) &  (\%) & 9162 (78.4\%) & 12562 (78.3\%) & 10951 (77.3\%) & 11479 (77.1\%)\\  -->
<!-- EthnicCategories &   &   &   &   &   &   &   &   &  \\  -->
<!-- \hspace{6pt}    Euro &  (\%) &  (\%) & 6731 (78.8\%) & 11024 (81.8\%) &  (\%) & 9671 (82.8\%) & 13389 (83.4\%) & 11814 (83.3\%) & 12427 (83.5\%)\\  -->
<!-- \hspace{6pt}    Maori &  (\%) &  (\%) & 1188 (13.9\%) & 1608 (11.9\%) &  (\%) & 1341 (11.5\%) & 1749 (10.9\%) & 1620 (11.4\%) & 1677 (11.3\%)\\  -->
<!-- \hspace{6pt}    Pacific &  (\%) &  (\%) & 284 (3.3\%) & 339 (2.5\%) &  (\%) & 277 (2.4\%) & 331 (2.1\%) & 243 (1.7\%) & 261 (1.8\%)\\  -->
<!-- \hspace{6pt}    Asian &  (\%) &  (\%) & 344 (4\%) & 501 (3.7\%) &  (\%) & 398 (3.4\%) & 579 (3.6\%) & 497 (3.5\%) & 518 (3.5\%)\\  -->
<!-- Male &   &   &   &   &   &   &   &   &  \\  -->
<!-- \hspace{6pt}    0 &  (\%) &  (\%) & 5302 (62\%) & 8457 (62.8\%) &  (\%) & 7325 (62.7\%) & 10148 (63.2\%) & 9011 (63.6\%) & 9433 (63.4\%)\\  -->
<!-- \hspace{6pt}    1 &  (\%) &  (\%) & 3245 (38\%) & 5015 (37.2\%) &  (\%) & 4362 (37.3\%) & 5900 (36.8\%) & 5163 (36.4\%) & 5450 (36.6\%)\\  -->
<!-- Partner &   &   &   &   &   &   &   &   &  \\  -->
<!-- \hspace{6pt}    0 &  (\%) &  (\%) & 2408 (28.2\%) & 3546 (26.3\%) &  (\%) & 2815 (24.1\%) & 3773 (23.5\%) & 3330 (23.5\%) & 3556 (23.9\%)\\  -->
<!-- \hspace{6pt}    1 &  (\%) &  (\%) & 6139 (71.8\%) & 9926 (73.7\%) &  (\%) & 8872 (75.9\%) & 12275 (76.5\%) & 10844 (76.5\%) & 11327 (76.1\%)\\  -->
<!-- Pol Orient &   &   &   &   &   &   &   &   &  \\  -->
<!-- Urban &   &   &   &   &   &   &   &   &  \\  -->
<!-- \hspace{6pt}    Not\_Urban &  (\%) &  (\%) & 2865 (33.5\%) & 4278 (31.8\%) &  (\%) & 3951 (33.8\%) & 5538 (34.5\%) & 2610 (18.4\%) & 2661 (17.9\%)\\  -->
<!-- \hspace{6pt}    Urban &  (\%) &  (\%) & 5682 (66.5\%) & 9194 (68.2\%) &  (\%) & 7736 (66.2\%) & 10510 (65.5\%) & 11564 (81.6\%) & 12222 (82.1\%)\\  -->
<!-- Beliefs &   &   &   &   &   &   &   &   &  \\  -->
<!-- \hspace{6pt}    \_Skeptic\_ &  (\%) &  (\%) & 2048 (24\%) & 3286 (24.4\%) &  (\%) & 2951 (25.3\%) & 4116 (25.6\%) & 3916 (27.6\%) & 4120 (27.7\%)\\  -->
<!-- \hspace{6pt}    \_SpiritExcludesGod\_ &  (\%) &  (\%) & 2295 (26.9\%) & 3735 (27.7\%) &  (\%) & 3169 (27.1\%) & 4501 (28\%) & 3918 (27.6\%) & 3970 (26.7\%)\\  -->
<!-- \hspace{6pt}    GodAndSpirit &  (\%) &  (\%) & 3707 (43.4\%) & 5499 (40.8\%) &  (\%) & 5119 (43.8\%) & 6453 (40.2\%) & 5464 (38.5\%) & 6210 (41.7\%)\\  -->
<!-- \hspace{6pt}    GodExcludesSpirit &  (\%) &  (\%) & 497 (5.8\%) & 952 (7.1\%) &  (\%) & 448 (3.8\%) & 978 (6.1\%) & 876 (6.2\%) & 583 (3.9\%)\\  -->
<!-- LIFESAT &   &   &   &   &   &   &   &   &  \\  -->
<!-- PWI &   &   &   &   &   &   &   &   &  \\  -->
<!-- \bottomrule -->
<!-- \end{tabular} -->
<!-- } -->
<!-- \end{table} -->
<!-- \] -->
<!-- \[ -->
<!-- \begin{table} -->
<!-- \begin{center} -->
<!-- \scalebox{0.6}{ -->
<!-- \begin{tabular}{l c c} -->
<!-- \toprule -->
<!--  & PWI & Life Satisfaction \\ -->
<!-- \midrule -->
<!-- (Intercept)                        & $\mathbf{6.63}^{***}$  & $\mathbf{4.94}^{***}$  \\ -->
<!--                                    & $(0.03)$               & $(0.02)$               \\ -->
<!-- Years                              & $0.00$                 & $-0.00$                \\ -->
<!--                                    & $(0.00)$               & $(0.00)$               \\ -->
<!-- Beliefs\_SpiritExcludesGod\_       & $\mathbf{-0.14}^{***}$ & $\mathbf{-0.08}^{***}$ \\ -->
<!--                                    & $(0.03)$               & $(0.02)$               \\ -->
<!-- BeliefsGodAndSpirit                & $\mathbf{-0.16}^{***}$ & $-0.04$                \\ -->
<!--                                    & $(0.03)$               & $(0.02)$               \\ -->
<!-- BeliefsGodExcludesSpirit           & $0.02$                 & $0.07$                 \\ -->
<!--                                    & $(0.05)$               & $(0.04)$               \\ -->
<!-- Age.10yrs.C                        & $\mathbf{0.08}^{***}$  & $\mathbf{0.09}^{***}$  \\ -->
<!--                                    & $(0.01)$               & $(0.01)$               \\ -->
<!-- Deprivation.S                      & $\mathbf{-0.14}^{***}$ & $\mathbf{-0.07}^{***}$ \\ -->
<!--                                    & $(0.01)$               & $(0.01)$               \\ -->
<!-- Edu.S                              & $\mathbf{0.12}^{***}$  & $\mathbf{0.06}^{***}$  \\ -->
<!--                                    & $(0.01)$               & $(0.01)$               \\ -->
<!-- EmployedEmployed                   & $\mathbf{0.09}^{***}$  & $\mathbf{0.08}^{***}$  \\ -->
<!--                                    & $(0.01)$               & $(0.01)$               \\ -->
<!-- EthnicCatsMaori                    & $\mathbf{-0.30}^{***}$ & $\mathbf{-0.06}^{**}$  \\ -->
<!--                                    & $(0.03)$               & $(0.02)$               \\ -->
<!-- EthnicCatsPacific                  & $\mathbf{-0.29}^{***}$ & $\mathbf{-0.08}^{*}$   \\ -->
<!--                                    & $(0.05)$               & $(0.04)$               \\ -->
<!-- EthnicCatsAsian                    & $-0.08$                & $-0.04$                \\ -->
<!--                                    & $(0.05)$               & $(0.03)$               \\ -->
<!-- Male1                              & $\mathbf{-0.11}^{***}$ & $\mathbf{-0.19}^{***}$ \\ -->
<!--                                    & $(0.02)$               & $(0.01)$               \\ -->
<!-- PartnerHas Partner                 & $\mathbf{0.61}^{***}$  & $\mathbf{0.42}^{***}$  \\ -->
<!--                                    & $(0.02)$               & $(0.01)$               \\ -->
<!-- Pol.Orient.S                       & $\mathbf{0.02}^{***}$  & $\mathbf{0.01}^{**}$   \\ -->
<!--                                    & $(0.01)$               & $(0.00)$               \\ -->
<!-- UrbanUrban                         & $\mathbf{-0.02}^{*}$   & $\mathbf{-0.02}^{*}$   \\ -->
<!--                                    & $(0.01)$               & $(0.01)$               \\ -->
<!-- Years:Beliefs\_SpiritExcludesGod\_ & $\mathbf{0.02}^{**}$   & $\mathbf{0.02}^{***}$  \\ -->
<!--                                    & $(0.00)$               & $(0.00)$               \\ -->
<!-- Years:BeliefsGodAndSpirit          & $\mathbf{0.02}^{***}$  & $\mathbf{0.01}^{***}$  \\ -->
<!--                                    & $(0.00)$               & $(0.00)$               \\ -->
<!-- Years:BeliefsGodExcludesSpirit     & $0.00$                 & $-0.00$                \\ -->
<!--                                    & $(0.01)$               & $(0.01)$               \\ -->
<!-- \midrule -->
<!-- AIC                                & $248580.18$            & $200599.16$            \\ -->
<!-- BIC                                & $248775.08$            & $200793.96$            \\ -->
<!-- Log Likelihood                     & $-124269.09$           & $-100278.58$           \\ -->
<!-- Num. obs.                          & $79270$                & $78888$                \\ -->
<!-- Num. groups: Id                    & $20979$                & $20972$                \\ -->
<!-- Var: Id (Intercept)                & $1.78$                 & $0.88$                 \\ -->
<!-- Var: Residual                      & $0.74$                 & $0.42$                 \\ -->
<!-- \bottomrule -->
<!-- \multicolumn{3}{l}{\scriptsize{$^{***}p<0.001$; $^{**}p<0.01$; $^{*}p<0.05$}} -->
<!-- \end{tabular} -->
<!-- } -->
<!-- \caption{Regression Models} -->
<!-- \label{table:coefficients} -->
<!-- \end{center} -->
<!-- \end{table} -->
<!-- \] -->
<!-- \newpage -->
<!-- ## Personal Well-Being -->
<!-- We fitted a linear mixed model (estimated using REML and nloptwrap optimizer) to predict personal well-being (PWI) with years (0-9), beliefs (four categories), Age.10yrs.C, deprivation (S), education (S), employed, ethnic categories, male, partner, political conservativism (S) and urban, with Id as a random effect. The model's intercept, corresponding to years = 0, beliefs = Skeptic, age = (sample mean), deprivation.S = (sample mean), education (S) =(sample mean), employed = not employed, ethnic Categories = European, male = not male, partner = no partner, political conservativism (S) = (sample mean), urban = not urban, is at 4.94 (SE = 0.02, 95% CI [4.89, 4.99], p < .001) is at 6.63 (SE = 0.03, 95% CI [6.57, 6.70], p < .001). Within this model: -->
<!--   - The effect of Years is positive is not reliable (beta = 2.66e-03, SE = 3.58e-03, std. beta = 3.19e-03, p = 0.458).  We infer that personal well-being did not increase in the Skeptic population between 2010 and 2018. -->
<!--   - The effect of Beliefs in *Spirit Excludes God*  is reliably negative (beta = -0.14, SE = 0.03, std. beta = -0.03, p < .001). We infer that in 2010, the population that believed in a Spirit but did not believe in a God had lower personal well-being than did Skeptics.  -->
<!--   - The effect of Beliefs in *God And Spirit*  is reliably negative (beta = -0.16, SE = 0.03, std. beta = -0.02, p < .001). We infer that in 2010, the population that believed in a God and a Spirit or Life Force had lower Personal Well-being than did Skeptics.  -->
<!--   - The effect of Beliefs in *God Excludes Spirit*  is not reliable (beta = 0.02, SE = 0.05, std. beta = 0.02, p = 0.669). We infer that in 2010, the population that believed in a God and doubted a Spirit or Life Force similar levels of personal well-being to Skeptics. -->
<!--   - The effect of Age.10yrs.C is reliably positive  (beta = 0.08, SE = 7.38e-03, std. beta = 0.07, p < .001). Older people tend to have greater personal well-being. -->
<!--   - The effect of Deprivation (S) is reliably negative (beta = -0.14, SE = 7.50e-03, std. beta = -0.08, p < .001). Deprived people tend to have lower personal well-being. -->
<!--   - The effect of Education (S) is reliably positive  (beta = 0.12, SE = 8.74e-03, std. beta = 0.07, p < .001). Educated people tend to have greater personal well-being. -->
<!--   - The effect of Employed is reliably positive  (beta = 0.09, SE = 0.01, std. beta = 0.05, p < .001). -->
<!--   - The effect of identifying as M\={a}ori is reliably negative (beta = -0.30, SE = 0.03, std. beta = -0.18, p < .001). -->
<!--   - The effect of identifying as Pacific is reliably negative (beta = -0.29, SE = 0.05, std. beta = -0.17, p < .001).  -->
<!--   - The effect of identifying as Asian is not reliable (beta = -0.08, SE = 0.05, std. beta = -0.05, p = 0.089). -->
<!--   - The effect of identifying as male is reliably negative (beta = -0.11, SE = 0.02, std. beta = -0.06, p < .001).  -->
<!--   - The effect of having a partner is reliably positive (beta = 0.61, SE = 0.02, std. beta = 0.37, p < .001). -->
<!--   - The effect of political conservativism (S) is reliably positive  (beta = 0.02, SE = 5.67e-03, std. beta = 0.01, p < .001).  -->
<!--   - The effect of living in an Urban area is reliably negative (beta = -0.02, SE = 0.01, std. beta = -0.01, p < .05). T -->
<!-- ##  Personal well-being: years X beliefs  -->
<!-- ```{r fig.cap = "Combination Coefficient plots for personal well-being and life satisfaction longitudinal growth models"} -->
<!-- knitr::include_graphics("Figs/USEPWI_expected-1.png") -->
<!-- ``` -->
<!-- Focusing on the interaction of time with belief-type on personal well-being we observe:  -->

<!--   - The effect of years $\times$ belief in a *Spirit Excludes God*  is reliably positive  (beta = 0.02, SE = 4.86e-03, std. beta = 0.02, p < .01). We infer that, unlike the skeptic population, people with beliefs in a spirit or life force who do not believe in a God tend to grow in their personal well-being over time. -->
<!--   - The effect of years $\times$ in *God And Spirit*  is reliably positive  (beta = 0.02, SE = 4.41e-03, std. beta = 0.03, p < .001). We infer that people who believe in a spirit or life force who also believe in a God tend to grow in their personal well-being over time -->
<!--   - The effect of Years $\times$ belief in *God Excludes Spirit*  is not reliable(beta = 1.96e-03, SE = 8.29e-03, std. beta = 2.36e-03, p = 0.813).  Thus, God believers who doubt in a Spirit or Life Force start maintain higher personal well-being than do other groups, but they are not expected to grow in personal well-being over time.  -->
<!-- ## Life Satisfaction  -->
<!-- We fitted a linear mixed model (estimated using REML and nloptwrap optimizer) to predict personal well-being (PWI) with years (0-9), beliefs (four categories), Age.10yrs.C, deprivation (S), education (S), employed, ethnic categories, male, partner, political conservativism (S) and urban, with Id as a random effect. Standardized parameters were obtained by fitting the model on a standardized version of the dataset. The model's total explanatory power is substantial (conditional R2 = 0.69). The model's intercept, corresponding to years = 0, beliefs = Skeptic, age = (sample mean), deprivation.S = (sample mean), education (S) =(sample mean), employed = not employed, ethnic Categories = European, male = not male, partner = no partner, political conservativism (S) = (sample mean), urban = not urban is at 4.94 (SE = 0.02, 95% CI [4.89, 4.99], p < .001). Within this model: -->
<!--   - The effect of years is not reliable (beta = -5.50e-04, SE = 2.69e-03, std. beta = -9.32e-04, p = 0.838).  We infer that life satisfaction did not increase in the Skeptic population between 2010 and 2018. -->
<!--   - The effect of beliefs in *Spirit Excludes God* is reliably negative (beta = -0.08, SE = 0.02, std. beta = 0.01, p < .001). We infer that overall the population that believes in a Spirit but does not believe in a God is expected to have a lower Life Satisfaction than skeptics.  -->
<!--   - The effect of beliefs in *God And Spirit* is not reliable (beta = -0.04, SE = 0.02, std. beta = 0.04, p = 0.105). People who believe in God but doubt a Spirit/Life force are expected to have had similar levels of life satisfaction in Wave 10 as skeptics. -->
<!--   - The effect of beliefs in *God Excludes Spirit* is reliably positive (beta = 0.07, SE = 0.04, std. beta = 0.05, p = 0.062).We infer that overall the population that believes in a God but does not believe in a spirit is not reliably different from  the Skeptics population in Life Satisfaction.  -->
<!--   - The effect of Age.10yrs.C is reliably positive (beta = 0.09, SE = 5.26e-03, std. beta = 0.10, p < .001). Older people have greater Life Satisfaction -->
<!--   - The effect of Deprivation (S) is  is reliably negative (beta = -0.07, SE = 5.50e-03, std. beta = -0.06, p < .001). People who are more deprived have lower Life Satisfaction. -->
<!--   - The effect of Education (S) is reliably positive (beta = 0.06, SE = 6.33e-03, std. beta = 0.05, p < .001). Educated people have greater Life Satisfaction -->
<!--   - The effect of being Employed is reliably positive (beta = 0.08, SE = 9.69e-03, std. beta = 0.07, p < .001). People who are employed tend to have greater Life Satisfaction -->
<!--   - The effect of identifying as Maori is reliably negative (beta = -0.06, SE = 0.02, std. beta = -0.05, p < .01).  People who belong to the minority Maori group tend to have lower Life Satisfaction. -->
<!--   - The effect of identifying as Pacific is reliably negative (beta = -0.08, SE = 0.04, std. beta = -0.07, p < .05).  People who belong to the minority Pacific peoples group tend to have lower life satisfaction. -->
<!--   - The effect of identifying as Asian is not reliably different from people of European ethnicity in life satisfaction(beta = -0.04, SE = 0.03, std. beta = -0.03, p = 0.223). -->
<!--   - The effect of identifying as male is reliably negative (beta = -0.19, SE = 0.01, std. beta = -0.16, p < .001). -->
<!--   - The effect of having a partner is reliably positive (beta = 0.42, SE = 0.01, std. beta = 0.35, p < .001). -->
<!--   - The effect of political conservativism (S) is reliably positive (beta = 0.01, SE = 4.23e-03, std. beta = 0.01, p < .01). -->
<!--   - The effect of living in an urban area is reliably negative (beta = -0.02, SE = 8.85e-03, std. beta = -0.02, p < .05). -->
<!-- ## Life Satisfaction: years X beliefs  -->
<!-- ```{r fig.cap = "Prediction Plot Life Satisfaction Spirit Belief Longitudinal Models"} -->
<!-- knitr::include_graphics("/Users/joseph/Documents/GitHub/nzavs_spiritbeliefWellbeing/Figs/USElifsat_expected-1.png") -->
<!-- ``` -->
<!--   - The interaction of years $\times$ beliefs in *Spirit Excludes God* ludesGod is reliably positive (beta = 0.02, SE = 3.66e-03, std. beta = 0.03, p < .001). We infer that, unlike the Skeptic population, people with beliefs in a Spirit or Life Force who do not believe in a God tend to grow in their Life Satisfaction over time. -->
<!--   - The interaction of years $\times$ *God And Spirit*  is reliably positive (beta = 0.01, SE = 3.32e-03, std. beta = 0.02, p < .001). We infer that people who believe in a spirit or life force who also believe in a God tend to grow in their life satisfaction over time -->
  <!--   - The effect of years $\times$ beliefs in *God Excludes Spirit*  is not reliable (beta = -1.59e-03, SE = 6.25e-03, std. beta = -2.70e-03, p = 0.799). Thus, God believers who doubt in a Spirit or Life Force start maintain higher Life-Satisfaction than do other groups, but they are not expected to grow in Life-Satisfaction over time.   -->
  